<?php

/**
 * organization
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    helpdesk
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class organization extends Baseorganization
{
    static function getOrganizationByClient()
    {
        $user_id = sfContext::getInstance()->getUser()->getAttribute('user_id' , null, 'sfGuardSecurityUser');
        // проверить или клиент
        $q = Doctrine::getTable('Organization')
        ->createQuery('o')
        ->select('o.*')
        ->leftJoin('o.Client c')
        ->where('c.user_id = ?',$user_id)
        ->execute()->getFirst();
        return $q;
    }
    
    static function getOrganizationByCurrentUser()
    {
        $user_id = sfContext::getInstance()->getUser()->getAttribute('user_id' , null, 'sfGuardSecurityUser');
        // проверить или клиент
        $q = Doctrine::getTable('Organization')
        ->createQuery('o')
        ->select('o.*')
        ->leftJoin('o.Client c')
        ->where('c.user_id = ?', $user_id)
        ->execute()->getFirst();
        return $q;
    }

  /**
   * Returns organization string with delimiter by ids
   *
   * @param int[] $ids
   * @param string $delimiter
   *
   * @return string
   */
  public static function getOrganizationString($ids, $delimiter = ',')
  {
    if (!sizeof($ids))
    {
      return '';
    }

    $organizations = Doctrine::getTable('Organization')
      ->createQuery('o')
      ->select('o.name')
      ->whereIn('o.id', $ids)
      ->fetchArray();

    $i = 0;

    $result = '';

    foreach ($organizations as $organization)
    {
      $i++;
      if ($i > 1)
      {
        $result .= ', ';
      }

      $result .= $organization['name'];
    }

    return $result;
  }
}