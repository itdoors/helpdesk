<?php

/**
 * sfGuardUser
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    helpdesk
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class sfGuardUser extends PluginsfGuardUser
{
   public function __toString()
   {
       return $this->getLastName().' '.$this->getFirstName();
   }

  public function getFullName()
  {
    return $this->getLastName().' '.$this->getFirstName();
  }

   public function getExistKurator($department_id, $claimtype_id)
   {
       $user = Doctrine::getTable('sfGuardUser')
       ->createQuery('s')
       ->leftJoin('s.Stuff sf')
       ->leftJoin('sf.StuffDe cu')
       ->leftJoin('sf.City c')
       ->leftJoin('c.Departments d')
       ->where('sf.user_id = s.id')
       ->addWhere('d.city_id = c.id')
       ->addWhere('cu.city_id = c.id')
       ->addWhere('cu.stuff_id = sf.id')
       ->addWhere('sf.stuffclass = \''.sfConfig::get('claimuserkey_kurator').'\'')
       ->addWhere('d.id ='.$department_id)
       ->execute();
       if ($user) return $user;  else return null;
   }
   
   public function getSexName()
   {
      $q = Doctrine_Core::getTable('lookup')->find($this->getSexId());
      if ($q<>null) return $q->getName(); else return '';
     //  return $q;  
    
   } 
   
   public function getDepartments()
   {
       $s = '<input type="button" value="Показать" class="departmentslist_for_stuff_btn" id="departmentslist_for_stuff_btn_id_'.$this->getId().'"/>'; 
       $s .= '<table id="departmentslist_for_stuff_table_id_'.$this->getId().'" class="departmentslist_for_stuff_table">'; 
       $stuff_departmentss = $this->getStuff()->getStuffDepartments();
       if (!count($stuff_departmentss)) return '';
       foreach ($stuff_departmentss as $stuff_departments)
       {
            $s .= '<tr>';
            //$s .= "<td>".$stuff_departments->getDepartments()."</td>"; 
            //$s .= "<td>".$stuff_departments->getUserkey()."</td>"; 
            //$s .= "<td>".$stuff_departments->getClaimtype()."</td>"; 
            //$s .= "<td>".$stuff_departments->getDepartments()->getOrganization()."</td>"; 
            $s .= '</tr>';
       }
       $s .= "</table>";
       return $s;
   }
   
   public function getClientorganization()
   {
       return $this->getClient()->getFirst()->getOrganization();
       
   }
   
   public function getPosition()
   {
     return $this->_data['position'];
   }
   
   
   
}