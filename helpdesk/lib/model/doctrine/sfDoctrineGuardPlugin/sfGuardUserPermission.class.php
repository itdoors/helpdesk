<?php

/**
 * sfGuardUserPermission
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    helpdesk
 * @subpackage model
 * @author     Your name here
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class sfGuardUserPermission extends PluginsfGuardUserPermission
{
    public function setClientPermission($client_id)
    {
        $permission = Doctrine::getTable('sfGuardPermission')->findOneBy('name',sfConfig::get('client_permission'));
        $userpermission_exist = Doctrine::getTable('sfGuardUserPermission')
        ->createQuery('c')
        ->where('user_id = '.$client_id)
        ->addWhere('permission_id ='.$permission->getId())
        ->fetchOne();
        
        if ($userpermission_exist == null)
        {
            $userpermission = new sfGuardUserPermission();
            $userpermission->setUserId($client_id);
            $userpermission->setPermissionId($permission->getId());
            $userpermission->trySave();    
        } 
    }
    
    public function setStuffPermission($client_id)
    {
        $permission = Doctrine::getTable('sfGuardPermission')->findOneBy('name',sfConfig::get('stuff_permission'));
        $userpermission_exist = Doctrine::getTable('sfGuardUserPermission')
        ->createQuery('c')
        ->where('user_id = '.$client_id)
        ->addWhere('permission_id ='.$permission->getId())
        ->fetchOne();
        
        if ($userpermission_exist == null)
        {
            $userpermission = new sfGuardUserPermission();
            $userpermission->setUserId($client_id);
            $userpermission->setPermissionId($permission->getId());
            $userpermission->trySave();    
        } 
       $stuff = Doctrine::getTable('stuff')->findOneBy('user_id',$client_id); 
       $stuff->setStuffclass(sfConfig::get('stuffclassstuff'));
       $stuff->trySave();
        
    }
    
    //public function setStuffPermission($client_id)  
    
    
     public function setKuratorPermission($client_id)
    {
        $permission = Doctrine::getTable('sfGuardPermission')->findOneBy('name',sfConfig::get('kurator_permission'));
        $userpermission_exist = Doctrine::getTable('sfGuardUserPermission')
        ->createQuery('c')
        ->where('user_id = '.$client_id)
        ->addWhere('permission_id ='.$permission->getId())
        ->fetchOne();
        
        if ($userpermission_exist == null)
        {
            $userpermission = new sfGuardUserPermission();
            $userpermission->setUserId($client_id);
            $userpermission->setPermissionId($permission->getId());
            $userpermission->trySave();    
        }
       $stuff = Doctrine::getTable('stuff')->findOneBy('user_id',$client_id); 
       $stuff->setStuffclass(sfConfig::get('stuffclasskurator'));
       $stuff->trySave(); 
    }
    
}